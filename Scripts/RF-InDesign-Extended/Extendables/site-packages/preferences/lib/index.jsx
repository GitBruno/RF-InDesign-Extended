if (typeof(rfidx) == 'undefined') {rfidx = require("rockfaxidx");}

exports.Store = function (name) {
	var self = this;
	this.file = rfidx.filesMatching(name)[0];

		
	if (typeof(this.file) === 'undefined') {
		var path = rfidx.IDPreferencesFolder().fullName + "/";
		name = name.toString().replace(/\.jso?n$/, '');
		this.file = new File(path+name+".json");
		out = this.file.open( 'w', undefined, undefined );
		this.file.encoding = "UTF-8";
		this.file.lineFeed = "Unix";
		if( out != false ){
      this.file.writeln("{}");
      this.file.close();
		}
	}

	this.exists = this.file.exists;
	
	this.save = function () {
		var data = this.json();
		this.file.open('w');
		this.file.write(data);
		this.file.close();
	};

	this.refresh = function () {
		this.file.open('r');
		var string = rfidx.decomment(this.file.read());
		if (string === '') {string = '{}';}
		this.data = string.deserialize('json');
		this.file.close();
	};
	
	this.destroy = function () {
		this.data = {};
		this.file.remove();
	};
	
	this.show = function () {
		this.file.execute();
	};
	
	this.wipe = function () {
		this.data = {};
		this.save();
	}
	
	this.json = function () {
		return JSON.stringify(this.data, null, '  ');
	}
	
	this.setValueForKey = function (val, key) {
		this.data[key] = val;
		this.save();
	};

	if (this.file.exists) {
		this.refresh();
	} else {
		this.data = {};
	}
	return this;
};