#target "InDesign";#targetengine 'main';$.level = 0;if (typeof(EXTENDABLES) === 'undefined') {#include "../../Extendables/extendables.jsx";}$.level = 0;if (typeof(preferences) == 'undefined') {var preferences = require("preferences");}var prefs = preferences.Store("set_item_layer.json");prefs.refresh();// prefs.data['text'] = "test";// prefs.save();main(prefs);function main (prefs) {  $.level = 0;  app.scriptPreferences.enableRedraw = true;  var layerNameArray = [];  for ( i=0 ; i<app.documents[0].layers.length ; i++ ) {    layerNameArray .push(app.documents[0].layers[i].name);  }  var desiredLayer = type_ahead (layerNameArray, prefs);    if ( typeof desiredLayer === 'undefined' ) {return;}  for ( i=0 ; i<app.documents[0].layers.length ; i++ ) {    if ( app.documents[0].layers[i].name === desiredLayer ) {      desiredLayer = app.documents[0].layers[i];      break;    }  }    if ( app.selection.length === 0 ) {    app.documents[0].activeLayer = desiredLayer;    return;  }  for ( i=app.selection.length-1 ; i>-1 ; i-- ) {    app.selection[i].itemLayer = desiredLayer;  }    app.scriptPreferences.enableRedraw = false;}function type_ahead(array, prefs) {  var w = new Window("dialog", "Set Item Layer");  var entry = w.add("edittext", [0, 0, 150, 22]);  entry.active = true;  entry.enterKeySignalsOnChange = true;  var list = w.add("listbox", [0, 0, 150, 220], array, {    scrolling: true  });  list.selection = 0;  entry.onChanging = function() {    _onChanging();  };    entry.onChange = function() {    w.close(1);  };      var okButton = w.add ("button", undefined, "OK");  okButton.visible = false;      var _onChanging = function() {    list.onChange = null;    prefs.data['text'] = entry.text;    prefs.save();    var temp = entry.text;    list.removeAll();    for(var i = 0; i < array.length; i++)    if(array[i].toLowerCase().indexOf(temp) == 0) list.add("item", array[i]);    if(list.items.length > 0) list.selection = 0;    list.onChange = function () {w.close(1);};  };      w.onShow = function() {    if (typeof(prefs.data['text']) != 'undefined') {      entry.text = prefs.data['text'];      _onChanging();    }  };  list.onChange = function () {w.close(1);};  if (w.show() != 2) {    return list.selection.text;  }else{    w.close();  }}